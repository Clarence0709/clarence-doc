<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="images/logo.png"><title>Java基础 | ClarenceDoc</title><meta name="description" content="实践是检验真理的唯一标准">
    <link rel="preload" href="/clarence-doc/assets/style-pXL2y8Rf.css" as="style"><link rel="stylesheet" href="/clarence-doc/assets/style-pXL2y8Rf.css">
    <link rel="modulepreload" href="/clarence-doc/assets/app-C-xOugFj.js"><link rel="modulepreload" href="/clarence-doc/assets/1_base.html-DvtA5Tzr.js">
    <link rel="prefetch" href="/clarence-doc/assets/index.html-yUErucn0.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_ai.html-BuJuL99X.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_opena_ai.html-CdveKJJV.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_deep_seek.html-dViN2DLk.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_0_complexity.html-OEQroUy5.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_1_list.html-BWqg6wXK.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_2_stack_queue.html-UtqsLAnw.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_3_hash.html-BVS8OK48.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_4_tree.html-dVdUO5NM.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_5_heap.html-DfW1CWon.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_6_graph.html-DBmB2rTW.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_7_search.html-BFJRlFHK.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_base_8_sort.html-BhXRRIjO.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_leet_code.html-GM45vnzs.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_huawei_code.html--M64U_Mi.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_structure.html-E7PXMh5l.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_cold_hot_data_split.html-7c_I7CDE.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_mysql_100_.html-DsDtQKRJ.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_redis.html-BqcC1r7V.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_memcached.html-CS9E-QkO.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_local_cache.html-DO68IcMi.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/99_other.html-CKBpLT7z.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-DsfFsUSu.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_linux.html-BUJBZkql.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_linux_0_centos.html-YaE1Mj0y.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_linux_1_ubuntun.html-DjVwcvu-.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_linux_2_debian.html-60ASG3LZ.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_virtual.html-DCYZ28Tm.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_docker.html-Ff-qLg86.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_k8s.html-BBd59AxL.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_currency.html-DGZx04TF.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_threadpool.html-vM0dcMw-.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_Indicator.html-BcR4LPm_.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_stressTest.html-D7oPn--_.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_high_concurrency_sys.html-BnPYBHI8.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_mysql.html-DQOXph4B.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_relational_db.html-CN1iZDq1.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_orm.html-yMmhs-Wx.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_column_db.html-oOPKgv7k.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_distributed_db.html-VO0qek4q.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/5_time_series_db.html-MgXAI0rT.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/6_file_db.html-BzKvbDht.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/7_search_db.html-enNVXaJR.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/sharding.html-BliNl6dg.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-l46tPpx0.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_design.html-i0zA7z9x.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_distributed.html-Dbc2qHD8.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_theorem.html-DLC0apD2.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_gateway.html-B-OuNZ6x.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_distributed_lock.html-CiIGgR3m.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_distributed_transaction.html-Di9_9D5w.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/5_distributed_session.html-sHEqHNdB.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_java.html-DrtbDzWs.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_db.html-Dk7oqhas.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_cache.html-CrfgXMXk.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_jvm.html-fSdK7irO.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/5_spring.html-DswNIcaS.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/6_spring_cloud.html-BzSb-Pjl.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/7_mq.html-BLLMaPkR.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_to_be_continue.html-nC3o2lgW.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_advanced.html-BzAQ5TH2.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-BJdukvqG.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/jvm.html-Cv-DqHUe.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-CAUZEETG.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_mq.html-BeP1NJRH.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_kafka.html-q4ZGnEzz.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_rocketmq.html-D88gPDdc.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_rabbitmq.html-VZRcXnZY.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/other.html-nOtimufq.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-zs3kPOL0.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_stick_split.html-_9lttdS8.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_io_model.html-6SEuLLgc.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_reactor.html-CfOt7aKu.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_io_stream.html-DVpaJHqO.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/0_scene.html-BpGZ0eK7.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_big_data_handle.html-DoBsTHzw.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/99_work_star.html-DEp9P3Lr.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_spring.html-QJaEr4WF.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_springboot.html-BntVrx5i.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_spring_security.html-BePUrD3O.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_security_framework.html-wV1H81dT.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/1_base.html-FYNekOqA.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/2_dis_or_advantages.html-BeYhrAQj.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/3_monolithic-to-microservices.html-sGBjNbWg.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/4_core_component.html-3CRBUPjl.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/5_devops_monitor.html-CQvW6zTr.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/6_high_available.html-CLJGx_85.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/99_best_practise.html-C2PrwdnJ.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/z_interview.html-5AM0Kihb.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/404.html-DcLJah31.js" as="script"><link rel="prefetch" href="/clarence-doc/assets/setupDevtools-7MC2TMWH-D68mkNe_.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/clarence-doc/"><img class="vp-site-logo" src="/clarence-doc/images/logo.png" alt="ClarenceDoc"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">ClarenceDoc</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/interview/0_java.html" aria-label="开发总结"><!---->开发总结<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/clarence-doc/java/1_base.html" aria-label="Java"><!---->Java<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/database/0_mysql.html" aria-label="数据库"><!---->数据库<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/cache/1_redis.html" aria-label="缓存"><!---->缓存<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/jvm/jvm.html" aria-label="JVM"><!---->JVM<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/spring/1_spring.html" aria-label="Spring"><!---->Spring<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/springcloud/1_base.html" aria-label="微服务"><!---->微服务<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/distributed/0_distributed.html" aria-label="分布式"><!---->分布式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/mq/1_mq.html" aria-label="消息队列"><!---->消息队列<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/currency/0_currency.html" aria-label="高并发"><!---->高并发<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/design/0_design.html" aria-label="设计模式"><!---->设计模式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/scene/0_scene.html" aria-label="场景题"><!---->场景题<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/netty/0_stick_split.html" aria-label="Netty"><!---->Netty<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/container/1_linux.html" aria-label="容器"><!---->容器<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/algorithm/0_base_0_complexity.html" aria-label="算法"><!---->算法<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/architecture/0_structure.html" aria-label="架构师"><!---->架构师<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/ai/0_ai.html" aria-label="AI"><!---->AI<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/interview/0_java.html" aria-label="开发总结"><!---->开发总结<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/clarence-doc/java/1_base.html" aria-label="Java"><!---->Java<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/database/0_mysql.html" aria-label="数据库"><!---->数据库<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/cache/1_redis.html" aria-label="缓存"><!---->缓存<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/jvm/jvm.html" aria-label="JVM"><!---->JVM<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/spring/1_spring.html" aria-label="Spring"><!---->Spring<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/springcloud/1_base.html" aria-label="微服务"><!---->微服务<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/distributed/0_distributed.html" aria-label="分布式"><!---->分布式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/mq/1_mq.html" aria-label="消息队列"><!---->消息队列<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/currency/0_currency.html" aria-label="高并发"><!---->高并发<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/design/0_design.html" aria-label="设计模式"><!---->设计模式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/scene/0_scene.html" aria-label="场景题"><!---->场景题<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/netty/0_stick_split.html" aria-label="Netty"><!---->Netty<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/container/1_linux.html" aria-label="容器"><!---->容器<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/algorithm/0_base_0_complexity.html" aria-label="算法"><!---->算法<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/architecture/0_structure.html" aria-label="架构师"><!---->架构师<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-doc/ai/0_ai.html" aria-label="AI"><!---->AI<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/clarence-doc/java/1_base.html" aria-label="Java基础"><!---->Java基础<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-doc/java/2_advanced.html" aria-label="Java高级特性"><!---->Java高级特性<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-doc/java/z_interview.html" aria-label="Java总结-Java"><!---->Java总结-Java<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="java基础" tabindex="-1"><a class="header-anchor" href="#java基础"><span>Java基础</span></a></h1><h2 id="一、hashmap分析" tabindex="-1"><a class="header-anchor" href="#一、hashmap分析"><span>一、Hashmap分析</span></a></h2><p>HashMap 是一种基于哈希表的数据结构，它实现了 Map 接口，用于存储键值对 (key-value)。其基本原理如下：</p><h3 id="_1、-哈希表-hash-table" tabindex="-1"><a class="header-anchor" href="#_1、-哈希表-hash-table"><span>1、 哈希表（Hash Table）</span></a></h3><p>HashMap 是基于哈希表实现的，哈希表的基本思想是通过将数据的键值对映射到一个数组的索引位置上来提高数据查找的效率。具体流程如下：</p><ul><li>哈希函数：</li></ul><p>HashMap 使用哈希函数将键（key）映射到数组的索引位置。哈希函数的目的是通过计算一个值，将不同的键映射到哈希表中的位置。</p><ul><li>数组：</li></ul><p>哈希表内部使用一个数组来存储数据。数组中的每个元素存储一个链表（或者在 Java 8 后是</p><a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>），用于处理哈希冲突。<h3 id="_2、-哈希冲突" tabindex="-1"><a class="header-anchor" href="#_2、-哈希冲突"><span>2、 哈希冲突</span></a></h3><p>由于哈希函数不可能做到完全唯一的映射，不同的键可能会被映射到相同的索引，这种情况称为哈希冲突。HashMap 通过以下方式解决哈希冲突：</p><ul><li><p>链表法（链式哈希）：</p></li><li><p>在发生冲突的情况下，HashMap 会将冲突的键值对存储到一个链表中 （或者 <a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>）。 当多个元素映射到同一个索引位置时，它们会形成一个链表。</p></li><li><a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>法：</li></ul><p>在 Java 8 及以后的版本中，如果链表的长度超过一定阈值（默认为 8），HashMap 会将链表转化为</p><a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>，以提高查询效率。<p><img src="/clarence-doc/assets/hashmap_hash_conflict-RhDZVAr2.png" alt="img.png"></p><h3 id="_3、-扩容机制" tabindex="-1"><a class="header-anchor" href="#_3、-扩容机制"><span>3、 扩容机制</span></a></h3><p>当 HashMap 中的元素过多时，哈希表的负载因子（load factor）可能会达到阈值，导致哈希表的存储效率降低。默认情况下，负载因子为 0.75。<strong>当元素个数超过当前容量 * 负载因子时，HashMap 会进行扩容</strong>（通常是原数组大小的 2 倍）。</p><p>扩容过程中，所有元素的哈希值会被重新计算，并重新放置到新的数组位置。这是因为<strong>哈希表的大小发生变化，导致原先的索引位置不再适用</strong>。</p><h3 id="_4、-时间复杂度" tabindex="-1"><a class="header-anchor" href="#_4、-时间复杂度"><span>4、 时间复杂度</span></a></h3><ul><li>查找、插入、删除操作的时间复杂度：</li></ul><p>在理想情况下，哈希表的查找、插入和删除操作的时间复杂度为 O(1)。但是，如果发生哈希冲突，性能会退化到 O(n)（链表长度为 n 时）。使用 <a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>优化后，最坏情况下时间复杂度为 O(log n)。</p><ul><li>扩容操作的时间复杂度：</li></ul><p>扩容是一个相对耗时的操作，时间复杂度为 O(n)，但扩容操作是按需进行的，不是频繁发生，因此平均而言，HashMap 的操作仍然是 O(1)。</p><h3 id="_5、-关键特点" tabindex="-1"><a class="header-anchor" href="#_5、-关键特点"><span>5、 关键特点</span></a></h3><ul><li>非线程安全：HashMap 不是线程安全的，如果在多线程环境下使用，需要考虑同步问题。</li><li>允许 null 键和 null 值：HashMap 允许一个 null 键和多个 null 值。</li><li>元素顺序不保证：HashMap 不保证键值对的顺序，因为它是基于哈希函数计算索引的，顺序是无序的。如果需要顺序，可以使用 LinkedHashMap</li></ul><h2 id="二、linkedhashmap分析" tabindex="-1"><a class="header-anchor" href="#二、linkedhashmap分析"><span>二、LinkedHashMap分析</span></a></h2><ul><li>类关联图如下所示</li></ul><p><img src="/clarence-doc/assets/LinkedHashMap-uNfJhtFw.png" alt=""></p><h2 id="三、concurrenthashmap分析" tabindex="-1"><a class="header-anchor" href="#三、concurrenthashmap分析"><span>三、ConcurrentHashMap分析</span></a></h2><h3 id="_1、concurrenthashmap基本特性" tabindex="-1"><a class="header-anchor" href="#_1、concurrenthashmap基本特性"><span>1、ConcurrentHashMap基本特性</span></a></h3><table><thead><tr><th><strong>特性</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><strong>线程安全</strong></td><td>采用 CAS + 自旋锁 替代 synchronized，减少锁竞争</td></tr><tr><td><strong>高并发</strong></td><td>读操作无锁，写操作局部加锁，避免全局锁的性能瓶颈</td></tr><tr><td><strong>不支持 null</strong></td><td>key 和 value 都 不能为 null，防止 NullPointerException</td></tr><tr><td><strong>比 Hashtable 性能高</strong></td><td>Hashtable 使用 synchronized 进行全表加锁，而 ConcurrentHashMap 采用 分段锁机制（JDK 1.7）和 CAS + 自旋锁（JDK 1.8）</td></tr></tbody></table><h3 id="_2、jdk-1-7-和-1-8-的区别" tabindex="-1"><a class="header-anchor" href="#_2、jdk-1-7-和-1-8-的区别"><span>2、JDK 1.7 和 1.8 的区别</span></a></h3><table><thead><tr><th><strong>版本</strong></th><th><strong>JDK 1.7</strong></th><th><strong>JDK 1.8 及以后</strong></th></tr></thead><tbody><tr><td><strong>底层数据结构</strong></td><td>Segment（分段锁） + 数组 + 链表</td><td>数组 + 链表 + 红黑树（大于 8 个元素）</td></tr><tr><td><strong>加锁方式</strong></td><td>分段锁（Segment 继承 ReentrantLock）</td><td>CAS + 自旋锁 + synchronized（局部）</td></tr><tr><td><strong>并发控制</strong></td><td>多个 Segment 互不影响</td><td>CAS 方式优化，减少锁竞争</td></tr><tr><td><strong>写入性能</strong></td><td>分段锁，性能较好</td><td>CAS + 局部锁，性能更高</td></tr><tr><td><strong>扩容机制</strong></td><td>Segment 级别扩容</td><td>无锁扩容，支持并发扩容</td></tr></tbody></table><ul><li>更多细节，如基本结构，及其方法，研究后再写；</li></ul><h2 id="四、concurrenthashmap为什么放弃分段锁" tabindex="-1"><a class="header-anchor" href="#四、concurrenthashmap为什么放弃分段锁"><span>四、ConcurrentHashMap为什么放弃分段锁？</span></a></h2><h3 id="_1、-分段锁的弊端" tabindex="-1"><a class="header-anchor" href="#_1、-分段锁的弊端"><span>1、 分段锁的弊端</span></a></h3><h4 id="🔴-1-1-扩容性能低" tabindex="-1"><a class="header-anchor" href="#🔴-1-1-扩容性能低"><span>🔴 1.1 扩容性能低</span></a></h4><p>JDK 1.7 ConcurrentHashMap 采用 <strong>分段锁（Segment）</strong>，每个 Segment 维护一个独立的 HashEntry[]，但在 扩容 时：</p><ul><li>需要 <strong>对整个 Segment 加锁</strong>，导致其他线程无法访问该 Segment，影响并发性能。</li><li><strong>迁移数据需要同步整个 Segment</strong>，多个线程不能同时进行数据迁移。</li></ul><h4 id="🔴-1-2-空间浪费" tabindex="-1"><a class="header-anchor" href="#🔴-1-2-空间浪费"><span>🔴 1.2 空间浪费</span></a></h4><ul><li>ConcurrentHashMap 预先分配多个 Segment，即使有的 Segment 为空，仍然占用内存，导致 空间利用率低。</li></ul><h4 id="🔴-1-3-结构复杂-代码难维护" tabindex="-1"><a class="header-anchor" href="#🔴-1-3-结构复杂-代码难维护"><span>🔴 1.3 结构复杂，代码难维护</span></a></h4><ul><li>Segment <strong>继承 ReentrantLock，导致 锁管理复杂</strong>，增加了不必要的开销。</li><li>Segment 结构导致 put 操作需要 <strong>两次 hash 计算</strong>（一次计算 Segment 索引，一次计算 Entry 索引），影响性能：</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"> <span class="token comment">// 找到 Segment</span></span>
<span class="line"><span class="token keyword">int</span> segmentIndex <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;&gt;</span> segmentShift<span class="token punctuation">)</span> <span class="token operator">&amp;</span> segmentMask<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 在该 Segment 内部查找</span></span>
<span class="line"><span class="token keyword">int</span> bucketIndex <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>segment<span class="token punctuation">.</span>table<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、-jdk-1-8-后新方案" tabindex="-1"><a class="header-anchor" href="#_2、-jdk-1-8-后新方案"><span>2、 JDK 1.8 后新方案</span></a></h3><p>JDK 1.8 直接去掉 Segment，采用 <strong>数组 + 链表 + 红黑树</strong> 结构，结合 CAS + synchronized 局部锁，实现更高效的并发控制：</p><h4 id="✅-2-1-采用-cas-无锁优化" tabindex="-1"><a class="header-anchor" href="#✅-2-1-采用-cas-无锁优化"><span>✅ 2.1 采用 CAS 无锁优化</span></a></h4><ul><li>CAS（Compare And Swap） 是一种 乐观锁，当多个线程竞争同一个 Node 插入时，采用 CAS 方式写入，避免不必要的锁竞争：</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这样，当 Node 为空时，线程可以 <strong>无锁写入</strong>，提高吞吐量。</li></ul><h4 id="✅-2-2-采用-synchronized-代替-reentrantlock" tabindex="-1"><a class="header-anchor" href="#✅-2-2-采用-synchronized-代替-reentrantlock"><span>✅ 2.2 采用 synchronized 代替 ReentrantLock</span></a></h4><ul><li>由于 synchronized 在 JDK 1.8 中已优化（锁粗化、锁消除、偏向锁等），其性能接近 ReentrantLock，因此 JDK 1.8 直接使用 synchronized 进行局部加锁：</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// f 是桶中的第一个节点</span></span>
<span class="line"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token function">putValUnderLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>只锁定当前桶位（Node[] 数组中的一个索引），避免对整个 Map 加锁，减少竞争。</li></ul><h4 id="✅-2-3-红黑树优化-提升查询性能" tabindex="-1"><a class="header-anchor" href="#✅-2-3-红黑树优化-提升查询性能"><span>✅ 2.3 红黑树优化，提升查询性能</span></a></h4><ul><li>如果某个桶的链表长度 超过 8，则转换为 红黑树，提升查询效率：</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>链表查询 O(n) → 红黑树查询 O(log n)，减少链表查找的性能损耗。</li></ul><h4 id="✅-2-4-支持无锁扩容" tabindex="-1"><a class="header-anchor" href="#✅-2-4-支持无锁扩容"><span>✅ 2.4 支持无锁扩容</span></a></h4><ul><li>多个线程可以并发迁移数据，提升扩容效率，避免 Segment 级别的全局锁：</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>sizeCtl <span class="token operator">&lt;</span> table<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token function">transferNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进行无锁扩容</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>采用 <strong>分批次迁移</strong>，多个线程 并行扩容，减少停顿时间。</li></ul><h2 id="四、hashmap、linkedhashmap、concurrenthashmap分析" tabindex="-1"><a class="header-anchor" href="#四、hashmap、linkedhashmap、concurrenthashmap分析"><span>四、HashMap、LinkedHashMap、ConcurrentHashMap分析</span></a></h2><table><thead><tr><th><strong>对比项</strong></th><th><strong>HashMap</strong></th><th><strong>LinkedHashMap</strong></th><th><strong>ConcurrentHashMap</strong></th></tr></thead><tbody><tr><td><strong>底层数据结构</strong></td><td>哈希表（数组 + 链表/红黑树）</td><td>哈希表 + 双向链表</td><td>哈希表（分段锁、CAS 机制）</td></tr><tr><td><strong>key 是否有序</strong></td><td>❌ 无序</td><td>✅ 按插入顺序排序</td><td>❌ 无序</td></tr><tr><td><strong>时间复杂度</strong></td><td>O(1) 平均，O(n) 最坏</td><td>O(1) 平均，O(n) 最坏</td><td>O(1) 平均，O(n) 最坏</td></tr><tr><td><strong>是否允许 null key</strong></td><td>✅ 允许</td><td>✅ 允许</td><td>❌ 不允许</td></tr><tr><td><strong>是否允许 null value</strong></td><td>✅ 允许</td><td>✅ 允许</td><td>❌ 不允许</td></tr><tr><td><strong>线程安全</strong></td><td>❌ 非线程安全</td><td>❌ 非线程安全</td><td>✅ 线程安全</td></tr><tr><td><strong>适用场景</strong></td><td>快速查找、无序存储、大量数据</td><td>需要按插入顺序遍历的场景</td><td>并发环境下的高效哈希映射</td></tr><tr><td><strong>主要应用</strong></td><td>缓存、映射查找、对象存储</td><td>LRU 缓存、访问顺序存储</td><td>高并发场景，如缓存、线程池</td></tr></tbody></table><h2 id="三、treemap分析" tabindex="-1"><a class="header-anchor" href="#三、treemap分析"><span>三、TreeMap分析</span></a></h2><h3 id="_1、源码分析" tabindex="-1"><a class="header-anchor" href="#_1、源码分析"><span>1、源码分析</span></a></h3><ul><li>类关联图如下所示：</li></ul><p><img src="/clarence-doc/assets/TreeMap-RKRumpct.png" alt="image.png"></p><ul><li>TreeMap 的核心特点</li></ul><table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>底层实现</td><td><a class="route-link" href="/clarence-doc/algorithm/0_base_4_tree.html#红黑树-balanced-binary-search-tree-bbst">红黑树</a>（Red-Black Tree），是一种自平衡二叉搜索树（BST）</td></tr><tr><td>排序方式</td><td>默认按 key 的 自然顺序（Comparable） 排序，也可以传入 自定义 Comparator</td></tr><tr><td>时间复杂度</td><td>O(log n)（增、删、查）</td></tr><tr><td>是否允许 null key</td><td>❌ 不允许 null key（会抛 NullPointerException）</td></tr><tr><td>是否允许 null value</td><td>✅ 允许 null value</td></tr><tr><td>是否线程安全</td><td>❌ 非线程安全（需要 Collections.synchronizedMap() 保护）</td></tr></tbody></table><div class="hint-container important"><p class="hint-container-title">使用途径</p><p>适用于需要 &quot;<strong>自动排序</strong>&quot; 和 &quot;<strong>范围查询</strong>&quot; 的场景。</p></div><p>1、适用场景：数据存储时要求按照 key 进行排序，方便后续查询和展示</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> productMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;Samsung&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token string">&quot;Huawei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 遍历时 key 是按顺序排序的（101, 102, 103）</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> productMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、需要 &quot;范围查询&quot; 或 &quot;区间搜索&quot;</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> transactionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707052800000L</span><span class="token punctuation">,</span> <span class="token string">&quot;订单 A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-05 00:00:00</span></span>
<span class="line">transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707139200000L</span><span class="token punctuation">,</span> <span class="token string">&quot;订单 B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-06 00:00:00</span></span>
<span class="line">transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707225600000L</span><span class="token punctuation">,</span> <span class="token string">&quot;订单 C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-07 00:00:00</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取 2 月 5 日到 2 月 6 日之间的交易</span></span>
<span class="line"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> transactionMap<span class="token punctuation">.</span><span class="token function">subMap</span><span class="token punctuation">(</span><span class="token number">1707052800000L</span><span class="token punctuation">,</span> <span class="token number">1707139200000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、相关类对比" tabindex="-1"><a class="header-anchor" href="#_2、相关类对比"><span>2、相关类对比</span></a></h3><table><thead><tr><th><strong>对比项</strong></th><th><strong>TreeMap</strong></th><th><strong>ConcurrentSkipListMap</strong></th></tr></thead><tbody><tr><td><strong>底层数据结构</strong></td><td>红黑树（Red-Black Tree）</td><td>跳表（Skip List）</td></tr><tr><td><strong>key 是否有序</strong></td><td>✅ 有序（按 key 排序）</td><td>✅ 有序（按 key 排序）</td></tr><tr><td><strong>时间复杂度</strong></td><td>O(log n)</td><td>O(log n)</td></tr><tr><td><strong>是否允许 null key</strong></td><td>❌ 不允许</td><td>❌ 不允许</td></tr><tr><td><strong>是否允许 null value</strong></td><td>✅ 允许</td><td>✅ 允许</td></tr><tr><td><strong>线程安全</strong></td><td>❌ 非线程安全</td><td>✅ 线程安全</td></tr><tr><td><strong>适用场景</strong></td><td>需要排序、范围查询、导航结构</td><td>并发环境下的有序映射</td></tr><tr><td><strong>主要应用</strong></td><td>排名、日志存储、区间查找</td><td>线程安全的排序映射结构</td></tr></tbody></table><h2 id="四、hashmap和hashtable的区别" tabindex="-1"><a class="header-anchor" href="#四、hashmap和hashtable的区别"><span>四、HashMap和HashTable的区别</span></a></h2><table><thead><tr><th>对比项</th><th>HashMap</th><th>Hashtable</th></tr></thead><tbody><tr><td><strong>线程安全</strong></td><td>❌ 非线程安全</td><td>✅ 线程安全（方法加锁 synchronized）</td></tr><tr><td><strong>性能</strong></td><td>🚀 性能更高（无锁）</td><td>🐌 性能较低（加锁导致开销大）</td></tr><tr><td><strong>是否允许 null</strong></td><td>✅ null key/value 允许</td><td>❌ null key/value 不允许</td></tr><tr><td><strong>数据结构</strong></td><td>JDK 1.8+: 数组 + 链表/红黑树</td><td>数组 + 链表</td></tr><tr><td><strong>默认初始容量</strong></td><td>16</td><td>11</td></tr><tr><td><strong>扩容方式</strong></td><td>容量翻倍（2^n 结构优化）</td><td>容量翻倍 + 1</td></tr><tr><td><strong>遍历方式</strong></td><td>迭代器 Iterator（fail-fast 机制）</td><td>Enumeration（旧版方式）</td></tr><tr><td><strong>适用场景</strong></td><td>适用于 单线程、高性能场景</td><td>适用于 历史遗留代码、并发场景（已被淘汰）</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>✅ 用 HashMap</p><ul><li>大多数场景 推荐使用 HashMap，只在单线程环境下使用。</li></ul><p>✅ 用 ConcurrentHashMap（代替 Hashtable）</p><ul><li>如果需要线程安全，<strong>请用 ConcurrentHashMap，不要用 Hashtable！</strong></li><li>ConcurrentHashMap 在 <strong>高并发 场景下比 Hashtable 性能更优（局部加锁，甚至无锁）</strong>。</li></ul></div><h2 id="五、java-泛型" tabindex="-1"><a class="header-anchor" href="#五、java-泛型"><span>五、Java 泛型</span></a></h2><p>常见问题，见：<a class="route-link" href="/clarence-doc/interview/0_java.html#十四、说说你对泛型的理解">Java总结-Java泛型</a></p><h3 id="_1、类型擦除" tabindex="-1"><a class="header-anchor" href="#_1、类型擦除"><span>1、类型擦除</span></a></h3><h4 id="_1-1、什么是类型擦除" tabindex="-1"><a class="header-anchor" href="#_1-1、什么是类型擦除"><span>1.1、什么是类型擦除？</span></a></h4><p>Java 泛型是编译时的特性，在运行时，Java 会移除（擦除）泛型的类型信息，这称为 类型擦除（Type Erasure）。</p><p><strong>原因</strong>：</p><p>Java 的泛型是为了<strong>向后兼容</strong>（Generics 是 JDK 1.5 引入的，而 Java 需要兼容早期版本）。 <strong>JVM 并不支持真正的泛型</strong>，所有泛型信息在编译阶段就被擦除，JVM 看到的只有原始类型（Raw Type）。</p><p><strong>示例（泛型擦除前 vs. 擦除后）：</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 泛型代码</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Box</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">T</span> value<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>编译后（擦除后的字节码）：</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 擦除泛型后的代码</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 泛型 T 变成 Object</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Object</span> value<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="六、线程的创建-thread-vs-runnable" tabindex="-1"><a class="header-anchor" href="#六、线程的创建-thread-vs-runnable"><span>六、线程的创建（Thread vs Runnable）</span></a></h2><h3 id="_1、继承-thread-类" tabindex="-1"><a class="header-anchor" href="#_1、继承-thread-类"><span>1、继承 Thread 类</span></a></h3><p>这种方法需要创建一个自定义的线程类，继承 Thread 类，并重写 run() 方法。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: Hello from thread!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MyThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 启动线程</span></span>
<span class="line">        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>优点：简单直观，适合只有一个任务的情况。</li><li>缺点：如果需要继承其他类，无法再继承 Thread 类（Java 是单继承）。</li></ul><h3 id="_2、实现-runnable-接口" tabindex="-1"><a class="header-anchor" href="#_2、实现-runnable-接口"><span>2、实现 Runnable 接口</span></a></h3><p>这种方法更灵活，创建一个实现 Runnable 接口的类，并将其作为参数传递给 Thread 构造函数。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: Hello from Runnable!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MyRunnable</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将任务传递给线程</span></span>
<span class="line">        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 启动线程</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>优点：允许实现多个接口，提供更多的灵活性和可扩展性。</li><li>缺点：比继承 Thread 类稍微复杂一些，但通常更加推荐。</li></ul><h2 id="七、volatile-关键字" tabindex="-1"><a class="header-anchor" href="#七、volatile-关键字"><span>七、volatile 关键字</span></a></h2><h3 id="_1、线程可见性" tabindex="-1"><a class="header-anchor" href="#_1、线程可见性"><span>1、线程可见性</span></a></h3><h3 id="_2、防止指令重排" tabindex="-1"><a class="header-anchor" href="#_2、防止指令重排"><span>2、防止指令重排</span></a></h3><h2 id="八、wait-notify-notifyall" tabindex="-1"><a class="header-anchor" href="#八、wait-notify-notifyall"><span>八、wait() / notify() / notifyAll()</span></a></h2><h2 id="九、线程池基础-executors-工具类" tabindex="-1"><a class="header-anchor" href="#九、线程池基础-executors-工具类"><span>九、线程池基础（Executors 工具类）</span></a></h2><h2 id="十、threadlocal" tabindex="-1"><a class="header-anchor" href="#十、threadlocal"><span>十、ThreadLocal</span></a></h2><h3 id="_1、基础原理" tabindex="-1"><a class="header-anchor" href="#_1、基础原理"><span>1、基础原理</span></a></h3><p>ThreadLocal 是 Java 提供的一个类，用于为<strong>每个线程提供独立的变量副本</strong>。每个线程访问自己的副本，不会与其他线程共享数据，常用于处理线程安全的问题。</p><ul><li>业务使用示意图</li></ul><p><img src="/clarence-doc/assets/threadlocal_usage-DJvxl6vh.png" alt="img_5.png"></p><ul><li>内部结构示意图：</li></ul><p><img src="/clarence-doc/assets/threadlocal_structure-Chz4M1CP.png" alt="img_5.png"></p><h3 id="_2、应用场景" tabindex="-1"><a class="header-anchor" href="#_2、应用场景"><span>2、应用场景</span></a></h3><ul><li><strong>数据库连接</strong>：如低代码系统中的数据源管理；</li></ul><p>为每个线程提供独立的数据库连接或事务对象，避免多个线程同时操作同一个连接，提升性能和安全性。</p><ul><li><strong>用户会话信息</strong>：如单体服务的用户会话信息管理；</li></ul><p>在 Web 应用中，可以使用 ThreadLocal 存储每个请求的用户会话信息，使每个线程能够独立地访问相关的会话数据。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1154937362@qq.com">Clarence</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1154937362@qq.com">hanchen</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><!----><a class="route-link auto-link next" href="/clarence-doc/java/2_advanced.html" aria-label="Java高级特性"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Java高级特性</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/clarence-doc/assets/app-C-xOugFj.js" defer></script>
  </body>
</html>
